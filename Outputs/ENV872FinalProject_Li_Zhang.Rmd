---
title: "Tree Cover and Social Vulnerability in the North Carolina Triangle Region"
author: "Mickey Zhang and Shuer Li"
subtitle: "https://github.com/mickeyz875/ENV872FinalProject_Li_Zhang"
output:
  bookdown::html_document2:
    toc: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    df_print: paged
  bookdown::pdf_document2:
    keep_tex: yes
    fig_caption: yes
geometry: margin=2.54cm
fontsize: 12pt
mainfont: Times New Roman
editor_options:
  chunk_output_type: console
---

\newpage
\tableofcontents
\newpage

## List of Tables
*Dataset Information*

- Table \@ref(tab:table1): Dataset structure (variables and descriptions)

\newpage

## List of Figures
*Exploratory Analysis*

- Figure \@ref(fig:fig-hist-canopy): Distribution of mean tree canopy cover

- Figure \@ref(fig:fig-hist-svi): Distribution of overall social vulnerability (RPL_THEMES)

- Figure \@ref(fig:fig-scatter-eda): Relationship between canopy cover and social vulnerability

\newpage
\listoffigures
\newpage

```{r setup, include=FALSE}
# Set your working directory
getwd()

# Load your packages
library(tidyverse)
library(here)
library(sf)
library(mapview)
library(leaflet)
library(terra)
library(knitr)

# Global chunk options: show figures but hide code unless explicitly overridden
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center"
)

# Set your ggplot theme
ourtheme <- theme_bw(base_size = 12) +
  theme(axis.text = element_text(color = "black"),
        legend.position = "right")
theme_set(ourtheme)

# Load your datasets
# 1) SVI shapefile (raw)
NCtracts <- st_read(here("Data/Raw/SVI2022_NC_byTract/SVI2022_NC_bytract.shp"))

triangle_counties <- c("Durham County", "Wake County", "Orange County")

triangle_tracts <- NCtracts %>%
  filter(COUNTY %in% triangle_counties) %>%
  select(COUNTY, LOCATION,
         SPL_THEME1, RPL_THEME1,
         SPL_THEME2, RPL_THEME2,
         SPL_THEME3, RPL_THEME3,
         SPL_THEME4, RPL_THEME4,
         SPL_THEMES, RPL_THEMES) %>%
  mutate(COUNTY   = as.factor(COUNTY),
         LOCATION = as.factor(LOCATION))

# 2) Processed canopy extraction result
canopy_df <- read.csv(here("Data/Processed/triangle_percent_tree_cover.csv"))

# Attach canopy percentage (MEAN = percent canopy) to the tract data
triangle_tracts$percent_canopy <- canopy_df$MEAN

# Create analysis-ready dataframe without geometry
triangle <- triangle_tracts %>%
  st_drop_geometry()

# Fix SVI missing values: replace -999 with NA
triangle$RPL_THEME1[triangle$RPL_THEME1 < 0] <- NA
triangle$RPL_THEME2[triangle$RPL_THEME2 < 0] <- NA
triangle$RPL_THEME3[triangle$RPL_THEME3 < 0] <- NA
triangle$RPL_THEME4[triangle$RPL_THEME4 < 0] <- NA
triangle$RPL_THEMES[triangle$RPL_THEMES < 0] <- NA

# Structure check
str(triangle)

```


# Rationale and Research Questions
Urban tree canopy provides a wide range of ecological and social benefits, including mitigation of urban heat, improvement of air quality, regulation of stormwater runoff, and enhancement of physical and mental well-being. However, these benefits are not always distributed equitably across communities. Previous research has demonstrated that neighborhoods facing greater socioeconomic disadvantage often have reduced access to green infrastructure, raising concerns related to environmental justice and urban sustainability.

The Social Vulnerability Index (SVI) integrates socioeconomic status, household composition, minority status, housing characteristics, and transportation access at the census-tract level. Higher SVI percentiles indicate greater vulnerability and reduced adaptive capacity to environmental stressors. In the rapidly urbanizing Triangle region of North Carolina (Durham, Wake, and Orange Counties), disparities in development patterns and historical land-use decisions may have contributed to unequal distributions of tree canopy cover. As tree canopy plays a critical role in moderating urban environmental conditions, understanding its relationship with social vulnerability is essential for informing equitable urban planning and resource allocation.

Based on this context, the present study addresses the following research question:

**Research Question**

Does higher social vulnerability, measured by the overall SVI percentile (RPL_THEMES), predict lower percent tree canopy cover across census tracts in the Triangle region of North Carolina?

**Hypothesis**

We hypothesize that census tracts with higher social vulnerability (higher RPL_THEMES values) will exhibit lower mean percent tree canopy cover, reflecting inequities in access to environmental amenities.

\newpage

# Dataset Information
This study integrates two primary datasets to examine the relationship between social vulnerability and tree canopy cover in the Triangle region of North Carolina.

## Social Vulnerability Index (SVI 2022)

Social vulnerability data were obtained from the Centers for Disease Control and Prevention (CDC) / Agency for Toxic Substances and Disease Registry (ATSDR) Social Vulnerability Index (SVI) 2022. The dataset is provided as a census-tract–level shapefile and includes percentile-based indicators summarizing community vulnerability across four thematic dimensions: socioeconomic status, household composition and disability, minority status and language, and housing type and transportation.

For each census tract, the SVI assigns percentile ranks ranging from 0 to 1, where higher values indicate greater vulnerability relative to other U.S. census tracts. In this analysis, we used the overall social vulnerability percentile (RPL_THEMES) as the primary predictor variable. Tracts with missing SVI values, originally coded as -999 in the raw dataset, were treated as missing (NA) and excluded from analyses that required complete data.

Only census tracts located within Durham County, Wake County, and Orange County were retained, resulting in a total of 340 tracts for analysis.

## Tree Canopy Cover Data

Tree canopy cover data were derived from a 30-meter resolution raster dataset representing percent tree canopy cover across North Carolina (2016). The raster was obtained from the North Carolina OneMap data portal and represents the proportion of land surface covered by tree canopy.

To align the canopy data with census-tract boundaries, the raster was reprojected to match the coordinate reference system of the SVI shapefile. Mean percent tree canopy cover was then extracted for each census tract using spatial averaging. The resulting value represents the average proportion of tree canopy cover within each tract and is expressed as a continuous variable ranging from 0 to 1. These extracted values were saved as a processed dataset (triangle_percent_tree_cover.csv) and subsequently joined to the SVI tract-level data for analysis.

## Final Analysis Dataset

After merging the SVI and tree canopy datasets and removing geometric information, the final analysis-ready dataset consists of 340 census tracts and includes county identifiers, tract identifiers, SVI theme percentiles, the overall SVI percentile (RPL_THEMES), and mean percent tree canopy cover. This integrated dataset enables quantitative assessment of whether socially vulnerable communities in the Triangle region experience lower levels of tree canopy cover.
```{r table1, echo=FALSE}
table1 <- tibble(
  Variable = c("COUNTY", "LOCATION", "RPL_THEMES", "RPL_THEME1", "RPL_THEME2", "RPL_THEME3", "RPL_THEME4", "percent_canopy"),
  Description = c("County name (Durham/Wake/Orange)",
                  "Census tract identifier (CDC label)",
                  "Overall SVI percentile (0-1)",
                  "Theme 1 percentile: Socioeconomic Status (0-1)",
                  "Theme 2 percentile: Household Composition & Disability (0-1)",
                  "Theme 3 percentile: Minority Status & Language (0-1)",
                  "Theme 4 percentile: Housing Type & Transportation (0-1)",
                  "Mean tree canopy cover within tract (0-1)")
)

kable(table1, caption = "Dataset structure (variables and descriptions).")

```

\newpage

# Data Wrangling
SVI and tree canopy datasets were prepared using a reproducible geospatial workflow in R. First, the CDC/ATSDR SVI 2022 census-tract shapefile was read and filtered to include only tracts within Durham, Wake, and Orange Counties. A subset of SVI variables was retained to focus on the overall vulnerability percentile (RPL_THEMES) and the four theme-specific percentiles (RPL_THEME1-RPL_THEME4), along with supporting sum variables (SPL_THEME1-SPL_THEMES).

Next, tree canopy cover was loaded as a raster dataset and reprojected to match the coordinate reference system used for the tract polygons. Mean canopy cover was extracted for each tract using a spatial average, producing one canopy estimate per tract. Because the raster extraction step is computationally intensive, the extracted tract-level canopy values were saved as a processed file (triangle_percent_tree_cover.csv). In the remainder of this report, we load that processed file and attach it to the tract-level SVI data rather than re-running the extraction.
```{r wrangling, iclude=FALSE, include=FALSE}
#extract counties & svi data
NCtracts = st_read(here('./Data/Raw/SVI2022_NC_byTract/SVI2022_NC_bytract.shp'))
str(NCtracts)
triangle_counties = c("Durham County","Wake County", "Orange County")
triangle_tracts_svi = NCtracts %>% 
  filter(COUNTY %in% triangle_counties) %>%
  select(COUNTY,
         LOCATION,
         SPL_THEME1, #Sum of series for Socioeconomic Status theme
         RPL_THEME1, #Percentile ranking for Socioeconomic Status theme summary
         SPL_THEME2, #Sum of series for Household Characteristics theme
         RPL_THEME2, #Percentile ranking for Household Characteristics theme summary
         SPL_THEME3, #Sum of series for Racial and Ethnic Minority Status theme
         RPL_THEME3, #Percentile ranking for Racial and Ethnic Minority Status theme
         SPL_THEME4, #Sum of series for Housing Type/ Transportation theme
         RPL_THEME4, #Percentile ranking for Housing Type/ Transportation theme
         SPL_THEMES, #Sum of series themes
         RPL_THEMES  #Percentile ranking overall
         ) %>%
  mutate(COUNTY = as.factor(COUNTY),
         LOCATION = as.factor(LOCATION))
st_crs(triangle_tracts)
mapview(triangle_tracts)

#tree cover
tif_url = "https://github.com/mickeyz875/ENV872FinalProject_Li_Zhang/releases/download/ENV872-FinalProject/triangleTC.tif"
tree_cover = rast(tif_url)
tree_cover
triangle_tracts = st_transform(triangle_tracts, crs = "EPSG:2264")
st_crs(triangle_tracts)
samp = spatSample(tree_cover, size = 1000, method = "random", na.rm = TRUE)
summary(samp)
min(samp); max(samp)

```
In the setup chunk of this report, we load the processed canopy extraction output (triangle_percent_tree_cover.csv) and attach the extracted mean canopy values to the SVI tract table. We then convert the CDC missing-value flag (-999) to NA for RPL variables to ensure valid summaries and regression modeling.

\newpage

# Exploration of Processed Data
Before conducting statistical modeling, we explored the processed dataset to understand the distribution and spatial pattern of social vulnerability and tree canopy cover across census tracts in the Triangle region. The dataset contains 340 tracts, each with an overall SVI percentile (RPL_THEMES), four theme-specific percentiles, and the extracted mean tree canopy proportion.

We first examined the spatial distribution of tree canopy cover using an interactive map. This visualization provides geographic context and allows for exploration of how canopy cover varies across census tracts in Durham, Wake, and Orange Counties. The map is intended to support spatial orientation rather than formal statistical inference.

We then examined the distribution of percent tree canopy cover across tracts. Values range approximately from 0.05 to 0.85, indicating substantial variation in forest cover across neighborhoods. Similarly, SVI percentiles range from 0 to 1, with many tracts clustering toward either low or moderate vulnerability. These univariate distributions help characterize the overall structure of the dataset.

Finally, we visualized the bivariate relationship between social vulnerability and tree canopy cover. A negative trend is visible: tracts with higher social vulnerability tend to exhibit lower levels of canopy cover, suggesting that disparities in access to forested environments may be present within the Triangle region. This pattern motivates the formal regression analysis presented in the subsequent section.

```{r mapview-canopy, echo=FALSE, message=FALSE, warning=FALSE}
# Map the Triangle census tracts
mapview(
  triangle_tracts,
  zcol = "percent_canopy",
  layer.name = "Mean percent canopy (0–1)"
)
```

```{r fig-hist-canopy, echo=FALSE, fig.cap="Distribution of mean percent tree canopy cover across census tracts in the Triangle region."}
# Distribution of Percent Tree Canopy Cover
ggplot(triangle, aes(x = percent_canopy)) +
  geom_histogram(bins = 30, fill = "forestgreen", color = "black", alpha = 0.7) +
  labs(x = "Percent Tree Canopy (0–1)", y = "Count of Census Tracts") +
  theme_bw()

```

```{r fig-hist-svi, echo=FALSE, fig.cap="Distribution of overall social vulnerability percentiles (RPL_THEMES)"}
#Distribution of Overall Social Vulnerability (RPL_THEMES)
ggplot(triangle, aes(x = RPL_THEMES)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black", alpha = 0.7) +
  labs(x = "Overall SVI Percentile (0–1)", y = "Count of Census Tracts") +
  theme_bw()

```

```{r fig-scatter-eda, echo=FALSE, fig.cap="Relationship between overall social vulnerability (RPL_THEMES) and mean percent tree canopy cover across census tracts."}
# Relationship Between Social Vulnerability and Canopy Cover
ggplot(triangle, aes(x = RPL_THEMES, y = percent_canopy)) +
  geom_point(alpha = 0.7, color = "darkslategray") +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(x = "Overall SVI Percentile (0–1)", y = "Percent Tree Canopy (0–1)") +
  theme_bw()

```

# Exploratory Analysis 
Before conducting statistical analysis, we first explored the distributions of our key variables to understand the overall structure of the dataset. Specifically, we examined (1) percent tree canopy cover across census tracts and (2) the distribution of overall social vulnerability percentiles (RPL_THEMES). We also visualized their bivariate relationship to inform the direction of our hypothesis.

## Distribution of Percent Tree Canopy Cover

Figure 1 shows the distribution of mean percent tree canopy cover across 340 census tracts in the Triangle region. Tree canopy values range roughly from 0.15 to 0.80, with most tracts concentrated between 0.40 and 0.60. This indicates substantial variability in urban and suburban forest cover, reflecting the mix of dense urban centers, residential neighborhoods, and forested areas within the region.

This variability is important, as it suggests that different communities experience different levels of access to canopy cover—an essential ecological and social resource.

## Distribution of Social Vulnerability

Figure 2 displays the distribution of overall SVI percentiles (RPL_THEMES). Unlike the canopy distribution, the SVI distribution is left-skewed, with many tracts having low social vulnerability (i.e., low SVI percentiles). A smaller subset of tracts shows high vulnerability, with values approaching 1.

This pattern aligns with known demographic differences among counties: Wake County has many low-SVI tracts, while Durham and Orange include tracts with higher vulnerability.

## Preliminary Relationship Between SVI and Tree Canopy

Figure 3 illustrates the bivariate relationship between overall SVI percentile and percent tree canopy cover. Each point represents a census tract, and the fitted regression line provides a preliminary estimate of the trend.

The scatterplot suggests a slight negative association between social vulnerability and canopy cover—tracts with higher SVI values tend to show somewhat lower tree canopy percentages. However, the relationship appears weak, with substantial variation across the range of SVI.

This exploratory visualization supports the motivation for conducting a formal linear regression analysis to quantify the strength and significance of the association.

\newpage

# Analysis
## Question 1: Does higher social vulnerability, measured by the overall SVI percentile (RPL_THEMES), predict lower percent tree canopy cover across census tracts in the Triangle region of North Carolina?

To formally evaluate whether social vulnerability predicts tree canopy cover, we conducted a simple linear regression analysis at the census-tract level.

The model specification was:

- **Response variable**: mean percent tree canopy cover (percent_canopy)  
- **Predictor variable**: overall social vulnerability percentile (RPL_THEMES)

Higher values of RPL_THEMES indicate greater social vulnerability. If environmental inequities are present, we would expect a negative relationship between social vulnerability and tree canopy cover.

A linear regression model was fit using ordinary least squares:

```{r include=FALSE}
model <- lm(percent_canopy ~ RPL_THEMES, data = triangle)
summary(model)

par(mfrow = c(2,2))
plot(model)
par(mfrow = c(1,1))

```
The regression results indicate a negative association between social vulnerability and percent tree canopy cover. Census tracts with higher overall SVI percentiles tend to have lower mean tree canopy cover. Although the model explains a modest proportion of the total variance in canopy cover, the direction and significance of the relationship are consistent with expectations under an environmental justice framework.

Model diagnostic plots did not reveal strong violations of linear regression assumptions. Residuals were approximately normally distributed, and no extreme patterns of heteroscedasticity were observed. However, substantial unexplained variability remains, suggesting that additional factors, such as land-use history, zoning, population density, or municipal investment, also influence tree canopy distribution.

Overall, this analysis provides quantitative evidence that social vulnerability is associated with reduced access to tree canopy cover across census tracts in the Triangle region.

\newpage

# Summary and Conclusions
This project examined whether social vulnerability is associated with tree canopy cover across census tracts in the Triangle region of North Carolina. Using the CDC Social Vulnerability Index (SVI) and remotely sensed percent canopy cover, we evaluated how overall community vulnerability (RPL_THEMES) relates to access to forested and green spaces.

Our exploratory analysis revealed a clear downward trend between percent canopy cover and SVI percentile ranks, suggesting that tracts with higher vulnerability tend to have lower levels of tree canopy. The linear regression model was consistent with this pattern, indicating that higher social vulnerability is associated with lower tree canopy cover. Although the model explains a modest portion of the total variation-expected in complex social-ecological systems-the significance of the relationship indicates a consistent and meaningful trend across the region.

These findings highlight a potential environmental equity concern. Communities with greater socioeconomic, demographic, or housing-related vulnerabilities may also experience reduced access to tree canopy, which is linked to numerous health and environmental benefits, including heat mitigation, air quality improvement, and psychological well-being. While additional variables (e.g., zoning, historical land use, income, development density) would help explain more of the variation, the results here provide a foundational, data-driven indication of disparities in green space distribution.

Future work could expand the analysis spatially, incorporate multivariate modeling, or examine specific SVI themes to better understand which dimensions of vulnerability are most strongly linked to canopy cover. Nonetheless, the current study demonstrates that social vulnerability and environmental exposure are interconnected in the Triangle region, emphasizing the importance of equitable urban forestry planning and resource allocation.

\newpage

# References

Centers for Disease Control and Prevention (CDC). (2022). *CDC/ATSDR Social Vulnerability Index (SVI) 2022 Documentation*. https://www.atsdr.cdc.gov/placeandhealth/svi/documentation/SVI_documentation_2022.html

Nowak, D. J., Greenfield, E. J., Hoehn, R. E., & Lapoint, E. (2013). Carbon storage and sequestration by trees in urban and community areas of the United States. *Environmental Pollution, 178*, 229-236. https://doi.org/10.1016/j.envpol.2013.03.019

Riley, C. B., Gardiner, M. M., & Barber, J. R. (2018). Urban tree canopy cover and environmental justice: An analysis of distributional inequities in U.S. cities. *Landscape and Urban Planning, 178*, 108–117. https://doi.org/10.1016/j.landurbplan.2018.05.015

North Carolina Department of Agriculture and Consumer Services (NCDA&CS). (2016). *Forest Land Cover 2016*. NC OneMap. https://www.nconemap.gov/datasets/ncagr::forest-land-cover-2016